---
title: "Model LF"
author: "Simon"
date: "11/7/2022"
output:
  pdf_document: default
  html_document: default
---

# Packages

```{r}
rm(list = ls())

library(tstools)
library(readxl)
library(tidyverse)
```

# Import data

```{r, message=FALSE}
AAMK <- read_excel("AAMK.xlsx")
globaldemand1 <- read_excel("globaldemand1.xlsx")


names(AAMK) <- tolower(names(AAMK))
names(globaldemand1) <- tolower(names(globaldemand1))

AAMK=lapply(AAMK, function(t) ts(t, start=c(2005, 2), end=c(2020, 1),frequency=4))
globaldemand1=lapply(globaldemand1, function(t) ts(t, start=c(2005, 2), end=c(2020, 1),frequency=4))

attach(AAMK)
attach(globaldemand1)
```

```{r}
## Change name in globaldemand1

g_20= globaldemand1$`g-20`

```

```{r}
eq_nf_l_nf = res_eq_nf_l
eq_f_l_f = res_eq_f_l
```



# Create dummies

```{r}
d_2006q1=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2006,1), dummy_end = c(2006,1),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2006q2=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2006,2), dummy_end = c(2006,2),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2006q3=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2006,3), dummy_end = c(2006,3),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2006q4=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2006,4), dummy_end = c(2006,4),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2007q34=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2007,3), dummy_end = c(2007,4),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2007q3=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2007,3), dummy_end = c(2007,3),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2017q23=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2017,2), dummy_end = c(2017,3),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2008q2=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2008,2), dummy_end = c(2008,2),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2008q3=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2008,3), dummy_end = c(2008,3),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2008q4=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2008,4), dummy_end = c(2008,4),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2009q4=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2009,4), dummy_end = c(2009,4),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2018q2=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2018,2), dummy_end = c(2018,2),
 basic_value = 0, dummy_value = 1, frequency = 4)

##### Er der noget specielt med dem her?????

d_20123 =  ts(c(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0), start = c(2005, 2), end =  c(2020,1), frequency = 4)


d_20124 =  ts(c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1), start = c(2005, 2), end =  c(2020,1), frequency = 4)

#### Videre igen 

d_2009q1=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2009,1), dummy_end = c(2009,1),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2009q2=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2009,2), dummy_end = c(2009,2),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2011q1=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2011,1), dummy_end = c(2011,1),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2014q3=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2014,3), dummy_end = c(2014,3),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2014q4=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2014,4), dummy_end = c(2014,4),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2013q4=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2013,4), dummy_end = c(2013,4),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2018q1=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2018,1), dummy_end = c(2018,1),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2016q3=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2016,3), dummy_end = c(2016,3),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2019q3=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2019,3), dummy_end = c(2019,3),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2019q4=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2019,4), dummy_end = c(2019,4),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2020q1=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2020,1), dummy_end = c(2020,1),
 basic_value = 0, dummy_value = 1, frequency = 4)

# DUMMY 4
dummy_2018q34 =create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2018,3), dummy_end = c(2018,4),
 basic_value = 0, dummy_value = 1, frequency = 4)

dummy_2011q1 =create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2011,1), dummy_end = c(2011,1),
 basic_value = 0, dummy_value = 1, frequency = 4)

dummy_2009q2 =create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2009,2), dummy_end = c(2009,2),
 basic_value = 0, dummy_value = 1, frequency = 4)

time= ts(1:length(dummy_2009q2), start = c(2005,2), frequency = 4)


DUMMY_4= ts(c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0), start = c(2005, 2), end =  c(2020,1), frequency = 4)

DUMMY_10= ts(c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0), start = c(2005, 2), end =  c(2020,1), frequency = 4)

DUMMY_11= ts(c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0), start = c(2005, 2), end =  c(2020,1), frequency = 4)




#### Variable der kun har en værdi:


wage_2010q3 = ts(c(86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268,86.36268), start = c(2005, 2), end =  c(2020,1), frequency = 4)


tax_rate2= ts(c(0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767,0.152767), start = c(2005, 2), end =  c(2020,1), frequency = 4)


tax_rate1= ts(c(0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369,0.389369), start = c(2005, 2), end =  c(2020,1), frequency = 4)



zz= ts(c(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1), start = c(2005, 2), end =  c(2020,1), frequency = 4)



urs= ts(c(0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04), start = c(2005, 2), end =  c(2020,1), frequency = 4)



shock= ts(c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0), start = c(2005, 2), end =  c(2020,1), frequency = 4)

```

Dummies til stød

```{r}
d_2013q4=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2013,4), dummy_end = c(2013,4),
 basic_value = 0, dummy_value = 1, frequency = 4)

d_2017q1=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2017,1), dummy_end = c(2017,1),
 basic_value = 0, dummy_value = 1, frequency = 4)
```


# Real Variables

```{r}
pc = cpi1/100
px = px/100
pi_1 = pi/100
pg= pg/100
pm = pm/100
py = py/100
pf = pc*xr/rer
rer = pc*xr/pf
pconk = pcon/pc
gk = g/pg
xk = x/px
mk = m/pm
```

```{r}

i_adj_h = i_h -  (i_equip_h + i_bd_h)
i_adj_nfc = i_nf - (i_equip_nfc + i_bd_nfc)
i_adj_fc = i_f - (i_equip_fc + i_bd_fc)
i_adj_g = i_g - (i_equip_g +i_bd_g)
```

```{r}
i_equip_h_k = i_equip_h/p_equip
i_equip_nfc_k =  i_equip_nfc/p_equip
i_equip_g_k = i_equip_g/p_equip
i_equip_fc_k =  i_equip_fc/p_equip
```

```{r}
i_bd_h_k =  i_bd_h/p_bd
i_bd_nfc_k =  i_bd_nfc/p_bd
i_bd_g_k =  i_bd_g/p_bd
i_bd_fc_k =  i_bd_fc/p_bd
```

I just deflate the adjustment terms using p_equip as well (assuming most of it is changes in inventories)

```{r}
i_adj_h_k = i_adj_h /p_equip
i_adj_nfc_k = i_adj_nfc /p_equip
i_adj_fc_k = i_adj_fc /p_equip
i_adj_g_k = i_adj_g /p_equip
```

we can compare ik with ikk. just to make sure we have all components of investment.

```{r}
ik =  i_equip_h_k + i_equip_nfc_k  +  i_equip_g_k + i_equip_fc_k +  i_bd_h_k + i_bd_nfc_k  +  i_bd_g_k  + i_bd_fc_k + i_adj_h_k + i_adj_nfc_k + i_adj_fc_k + i_adj_g_k

ikk = i/pi_1
```

```{r}
yk = ik + pconk + gk + xk - mk
```

```{r}

npropinc_h = propinc_r_h - propinc_p_h
nsben_h = sben_h_r - scon_h_p
```

```{r}
iba_f = - (iba_h + iba_nf + iba_g + iba_row) # The data from the database is not consistent (the sum of the stocks of IBA does not add up to zero). I fix it by assuming that iba_f is entirely demand-led.

iba_f_tr = - (iba_h_tr + iba_nf_tr + iba_g_tr + iba_row_tr) #The data from the database is not consistent (the sum of IBA transactions does not add up to zero). I fix it by assuming that iba_f_tr is entirely demand-led.
```

```{r}
### Jeg tager bare og fjerner første observation fra dem der er minuse så den først starer i 2005q3

iba_h_rvx=diff(iba_h)-iba_h_tr[-1]
iba_f_rvx=diff(iba_f)-iba_f_tr[-1]
iba_nf_rvx=diff(iba_nf)-iba_nf_tr[-1]
iba_g_rvx=diff(iba_g)-iba_g_tr[-1]
iba_row_rvx=diff(iba_row)-iba_row_tr[-1]
```

```{r}
eq_h = - ((eq_f_a - eq_f_l) + (eq_nf_a - eq_nf_l) + eq_g + (eq_row_a - eq_row_l)) #The data from the database is not consistent (the sum of the stocks of equities does not add up to zero). I fix it by assuming that eq_h absorbbs the small discrepancies that come from the database.
```

```{r}
### Der ages diff så de sarer alle i 2005Q3

eq_h_rvx=diff(eq_h)-eq_h_tr[-1]
eq_f_a_rvx=diff(eq_f_a)-eq_f_a_tr[-1]
eq_f_l_rvx=diff(eq_f_l)-eq_f_l_tr[-1]
eq_nf_a_rvx=diff(eq_nf_a)-eq_nf_a_tr[-1]
eq_nf_l_rvx=diff(eq_nf_l)-eq_nf_l_tr[-1]
eq_g_rvx=diff(eq_g)-eq_g_tr[-1]
eq_row_a_rvx=diff(eq_row_a)-eq_row_a_tr[-1]
eq_row_l_rvx=diff(eq_row_l)-eq_row_l_tr[-1]
```

```{r}

### Tror også alle disse starer i 2005Q3

Neq_row = eq_row_a - eq_row_l 
Neq_nf = eq_nf_a - eq_nf_l 
Neq_f = eq_f_a - eq_f_l 
Neq_nf_rvx = eq_nf_a_rvx-eq_nf_l_rvx
Neq_f_rvx = eq_f_a_rvx-eq_f_l_rvx
Neq_row_rvx = eq_row_a_rvx-eq_row_l_rvx
Neq_nf_tr = diff(Neq_nf)-(Neq_nf_rvx)
Neq_f_tr = diff(Neq_f)-(Neq_f_rvx)
alpha_neq_nf = -Neq_nf/i_nf
Neq_row_tr = diff(Neq_row) - Neq_row_rvx
```

```{r}
eq_h_tr = - (Neq_nf_tr  + Neq_f_tr + eq_g_tr[-1] + Neq_row_tr) # The data from the database is not consistent (the sum of the stocks of equities does not add up to zero). I fix it by assuming that eq_h_tr absorbbs the small discrepancies that come from the database.
```

```{r}
eq_f_l_rvx = diff(eq_f_l)-eq_f_l_tr[-1]
eq_nf_l_rvx = diff(eq_nf_l)-eq_nf_l_tr[-1]
eq_row_l_rvx = diff(eq_row_l)-eq_row_l_tr[-1]
```

```{r}
ins_f = - (ins_row + ins_h + ins_nf + ins_g) # The database is almost consistent, but I redifine ins_f to make it fully consistent and avoid carrying discrepancies along when running the simulations.
ins_f_tr = - (ins_row_tr + ins_h_tr + ins_nf_tr + ins_g_tr) # The database is almost consistent, but I redifine ins_f_tr to make it fully consistent and avoid carrying discrepancies along when running the simulations.
```

```{r}
ins_h_rvx=diff(ins_h)-ins_h_tr[-1]
ins_f_rvx=diff(ins_f)-ins_f_tr[-1]
ins_nf_rvx=diff(ins_nf)-ins_nf_tr[-1]
ins_g_rvx=diff(ins_g)-ins_g_tr[-1]
ins_row_rvx=diff(ins_row)-ins_row_tr[-1]
```

```{r}
sec_g = - (sec_row + sec_h + sec_f_a + sec_f_d + sec_nf) # The database is almost consistent, but I redifine sec_g to make it fully consistent and avoid carrying discrepancies along when running the simulations.
sec_g_tr = - (sec_row_tr + sec_h_tr + sec_f_a_tr + sec_f_d_tr + sec_nf_tr) # The database is almost consistent, but I redifine sec_g to make it fully consistent and avoid carrying discrepancies along when running the simulations.
```

```{r}
sec_h_rvx=diff(sec_h)-sec_h_tr[-1]
sec_f_a_rvx=diff(sec_f_a)-sec_f_a_tr[-1]
sec_f_d_rvx=diff(sec_f_d)-sec_f_d_tr[-1]
sec_nf_rvx=diff(sec_nf)-sec_nf_tr[-1]
sec_g_rvx=diff(sec_g)-sec_g_tr[-1]
sec_row_rvx=diff(sec_row)-sec_row_tr[-1]
```

```{r}
l_f = - (l_h + l_nf + l_g + l_row) # The database is almost consistent, but I redifine l_f to make it fully consistent and avoid carrying discrepancies along when running the simulations.
l_f_tr = - (l_h_tr + l_nf_tr + l_g_tr + l_row_tr) # The database is almost consistent, but I redifine l_f to make it fully consistent and avoid carrying discrepancies along when running the simulations.
```

```{r}
l_h_rvx=diff(l_h)-l_h_tr[-1]
l_f_rvx=diff(l_f)-l_f_tr[-1]
l_nf_rvx=diff(l_nf)-l_nf_tr[-1]
l_g_rvx=diff(l_g)-l_g_tr[-1]
l_row_rvx=diff(l_row)-l_row_tr[-1]
```

```{r}
int_nf_adj = (int_r_nf - int_p_nf) - (stats::lag(idep,-1)*stats::lag(iba_nf,-1) + stats::lag(ibd,-1)*stats::lag(sec_nf,-1) + stats::lag(iloan,-1)*stats::lag(l_nf,-1))

int_h_adj = (int_r_h - int_p_h) - (stats::lag(idep,-1)*stats::lag(iba_h,-1) +stats::lag(iloan,-1)*stats::lag(l_h,-1)+ stats::lag(ibd,-1)*stats::lag(sec_h,-1) ) # this calculation calculates the discrepancy for interest payments as net flow.
```

```{r}
#Below I (hamid) compute discrepancy between interest payments and reciepts separately to create a measure of propert income (paid and recieved) instead of just using net property income (npropinc) in the model

int_r_h_adj = int_r_h  - (stats::lag(idep,-1)*stats::lag(iba_h,-1)  + stats::lag(ibd,-1)*stats::lag(sec_h,-1))

int_p_h_adj = int_p_h  + stats::lag(iloan,-1)*stats::lag(l_h,-1)
```

```{r}
#For the rest of the sectors, we just calculate the discrepancies based on net asset holding
int_g_adj = (int_r_g - int_p_g) - (stats::lag(idep,-1)*stats::lag(iba_g,-1) + stats::lag(iloan,-1)*stats::lag(l_g,-1) + stats::lag(ibd,-1)*stats::lag(sec_g,-1))

int_row_adj = (int_r_row - int_p_row) - (stats::lag(idep,-1)*stats::lag(iba_row,-1) + stats::lag(iboa,-1)*stats::lag(sec_row,-1) + stats::lag(iloan,-1)*stats::lag(l_row,-1))


int_f_adj = (int_r_f - int_p_f) - (stats::lag(idep,-1)*stats::lag(iba_f,-1) + stats::lag(iloan,-1)*stats::lag(l_f,-1) + stats::lag(ibd,-1)*stats::lag(sec_f_d,-1) + stats::lag(iboa,-1)*stats::lag(sec_f_a,-1))
```

```{r}
test = int_nf_adj  + int_h_adj  + int_g_adj  + int_f_adj  + int_row_adj
```

Below we create series for equities viz-a-viz counterparties. The data is only available from 2012 onwards so we use the porportion w.r.t to the aggregate payments to create data back in time (because we have aggregate data)

```{r}
alpha_nf_rv = eq_h_nf_rv[31:60]/(eq_h_nf_rv[31:60] + eq_h_f_rv[31:60] + eq_h_row_rv[31:60]) ## mean of alpha is 0.57 (excluding the spike in the start of the sample somwhere 2013q3 (not sure about the exact point))
alpha_f_rv = eq_h_f_rv[31:60]/(eq_h_nf_rv[31:60] + eq_h_f_rv[31:60] + eq_h_row_rv[31:60]) #  mean of alpha is 0.37 (excluding the spike in the start of the sample somwhere 2013q3 (not sure about the exact point))
alpha_row_rv = eq_h_row_rv[31:60]/(eq_h_nf_rv[31:60] + eq_h_f_rv[31:60] + eq_h_row_rv[31:60]) # mean of alpha is 0.06 (excluding the spike in the start of the sample somwhere 2013q3 (not sure about the exact point))
```

dummies for equity revaluation equations

```{r}
dummy_1=ts(c(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0), start = c(2005, 2), end = c(2020,1), frequency = 4)

dummy_2=create_dummy_ts(start_basic = c(2005, 2), end_basic=c(2020,1),
 dummy_start=c(2013,1), dummy_end = c(2020,1),
 basic_value = 0, dummy_value = 1, frequency = 4)
```

```{r}
eq_h_row_rvx = dummy_1*0.06*eq_h_rvx + dummy_2*eq_h_row_rv
eq_h_nf_rvx = dummy_1*0.57*eq_h_rvx + dummy_2*eq_h_nf_rv
eq_h_f_rvx = dummy_1*0.37*eq_h_rvx + dummy_2*eq_h_f_rv
eq_h_rvx1 = eq_h_nf_rvx + eq_h_f_rvx + eq_h_row_rvx
```

We now create stock of equities data based on counter parties.

```{r}
alpha_nf = eq_h_nf[31:60]/eq_h[31:60] #mean of the series 0.275
alpha_f = eq_h_f[31:60]/eq_h[31:60] #mean of the series 0.663
#alpha_row = eq_h_row/eq_h
alpha_row = 1 - alpha_nf - alpha_f


### I create these to keep the same time dimension

alpha_nf= ts(c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,alpha_nf),start = c(2005,2), frequency = 4)

alpha_f= ts(c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,alpha_f),start = c(2005,2), frequency = 4)

alpha_row= ts(c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,alpha_row),start = c(2005,2), frequency = 4)


```

```{r}
#eq_h_nf = dummy_1*0.275*eq_h + dummy_2*eq_h_nf
#eq_h_f = dummy_1*0.663*eq_h + dummy_2*eq_h_f
#eq_h_row = dummy_1*0.062*eq_h  + dummy_2*eq_h_row 
```

```{r}
gamma_1 = eq_h_nf / eq_h
gamma_2 = eq_h_f / eq_h
```

```{r}
#series  iba_h_tr = fn
```

```{r}
library(stats)

div_nf2_adj = (div_r_nf  - div_p_nf) - ((stats::lag(eq_nf_a_nf,-1) + stats::lag(eq_nf_a_f,-1) - stats::lag(eq_nf_l_nf,-1) + stats::lag(eq_h_nf,-1)+ stats::lag(eq_row_a_nf,-1) + stats::lag(eq_f_a_nf,-1) + stats::lag(eq_g_nf,-1)))* stats::lag(divd,-1) + stats::lag(eq_nf_a_row,-1)*stats::lag(diva,-1)
```

```{r}
div_nf1_adj =  (div_r_nf  - div_p_nf) - (stats::lag(Neq_nf,-1)*stats::lag(divd,-1))
```

```{r}
div_nf_adj = d_20124*(div_nf2_adj) + (1-d_20124)*(div_nf1_adj)
```

```{r}
div_nf =d_20124*(((stats::lag(eq_nf_a_nf,-1) + stats::lag(eq_nf_a_f,-1) - stats::lag(eq_nf_l_nf,-1) + stats::lag(eq_h_nf,-1) + stats::lag(eq_row_a_nf,-1) + stats::lag(eq_f_a_nf,-1) + stats::lag(eq_g_nf,-1)))* stats::lag(divd,-1) + stats::lag(eq_nf_a_row,-1)*stats::lag(diva,-1)) + (1-d_20124)*(stats::lag(Neq_nf,-1)*stats::lag(divd,-1)) + div_nf_adj

div_nf1 =  div_r_nf - div_p_nf
```

```{r}
div_f2_adj = (div_r_f  - div_p_f) - ((stats::lag(eq_f_a_nf,-1) + stats::lag(eq_f_a_f,-1) - (stats::lag(eq_f_l_f,-1) + stats::lag(eq_h_f,-1)+ stats::lag(eq_row_a_f,-1) + stats::lag(eq_row_a_f,-1) + stats::lag(eq_g_f,-1)))* stats::lag(divd,-1) + stats::lag(eq_f_a_row,-1)*stats::lag(diva,-1))
```

```{r}
div_f1_adj =  (div_r_f  - div_p_f) - (stats::lag(Neq_f,-1)*stats::lag(divd,-1))

div_f_adj = d_20124*div_f2_adj + (1-d_20124)*(div_f1_adj)

```

```{r}
div_f = d_20124 *(((stats::lag(eq_f_a_f,-1) + stats::lag(eq_nf_a_nf,-1)) - (stats::lag(eq_f_l_f,-1) + stats::lag(eq_h_f,-1)+ stats::lag(eq_row_a_f,-1) + stats::lag(eq_nf_a_f,-1) + stats::lag(eq_g_f,-1)))* stats::lag(divd,-1) + stats::lag(eq_f_a_row,-1)*stats::lag(diva,-1)) + (1-d_20124)*((stats::lag(Neq_f,-1)*stats::lag(divd,-1))) +  div_f_adj 


div_f1 =  div_r_f - div_p_f
```

```{r}
div_h2_adj = div_r_h - ((stats::lag(eq_h_nf,-1) + stats::lag(eq_h_f,-1))*stats::lag(divd,-1) + stats::lag(eq_h_row,-1)*stats::lag(diva,-1))

div_h1_adj =  div_r_h - (stats::lag(eq_h,-1)*stats::lag(divd,-1))

div_h_adj  = d_20124*div_h2_adj + (1-d_20124)*(div_h1_adj)
```

```{r}
div_h = d_20124*((stats::lag(eq_h_nf,-1) + stats::lag(eq_h_f,-1))*stats::lag(divd,-1) + stats::lag(eq_h_row,-1)*stats::lag(diva,-1)) + (1-d_20124)*(stats::lag(eq_h,-1)*stats::lag(divd,-1)) +  div_h_adj

div_h1 = div_r_h - div_p_h
```

```{r}
div_g2_adj = div_r_g - ((stats::lag(eq_g_nf,-1) + stats::lag(eq_g_f,-1))*stats::lag(divd,-1) + stats::lag(eq_g_row,-1)*stats::lag(diva,-1))

div_g1_adj =  div_r_g - (stats::lag(eq_g,-1)*stats::lag(divd,-1))

div_g_adj = d_20124*div_g2_adj + (1-d_20124)*(div_g1_adj)

div_g = d_20124 * ( (stats::lag(eq_g_nf,-1) + stats::lag(eq_g_f,-1))*stats::lag(divd,-1) + stats::lag(eq_g_row,-1)*stats::lag(diva,-1) ) + (1-d_20124) * ((stats::lag(eq_g,-1)*stats::lag(divd,-1))) + div_g_adj

div_g1 =  div_r_g - div_p_g
```

```{r}
div_row2_adj = (div_r_row - div_p_row) - ((stats::lag(eq_row_a_nf,-1) + stats::lag(eq_row_a_f,-1))*stats::lag(divd,-1) - ((stats::lag(eq_nf_a_row,-1)+stats::lag(eq_f_a_row,-1)+stats::lag(eq_g_row,-1)+stats::lag(eq_h_row,-1))*stats::lag(diva,-1)))

div_row1_adj = (div_r_row - div_p_row) - (stats::lag(Neq_row,-1)*stats::lag(divd,-1))

div_row_adj = d_20124*div_row2_adj + (1-d_20124)*(div_row1_adj)
```

```{r}
div_row = d_20124 * (  (stats::lag(eq_row_a_nf,-1) + stats::lag(eq_row_a_f,-1))*stats::lag(divd,-1) - ((stats::lag(eq_nf_a_row,-1)+stats::lag(eq_f_a_row,-1)+stats::lag(eq_g_row,-1)+stats::lag(eq_h_row,-1))*stats::lag(diva,-1))) + (1-d_20124) * ((stats::lag(Neq_row,-1)*stats::lag(divd,-1))) + div_row_adj
```

```{r}
div_row1 =  div_r_row - div_p_row
```

```{r}
check_div1 =  (div_r_row - div_p_row) +  (div_r_g - div_p_g) +  (div_r_h - div_p_h) +  (div_r_nf - div_p_nf) +  (div_r_f - div_p_f)

check_div = div_h + div_f + div_g + div_nf + div_row

check_div_adj1 = div_h1_adj  + div_f1_adj  +div_nf1_adj  +div_g1_adj  +div_row1_adj   

check_div_adj2 = div_h2_adj  + div_f2_adj  +div_nf2_adj  +div_g2_adj  +div_row2_adj   
```

```{r}
ins_nf_adj = (ins_r_nf - ins_p_nf) - (stats::lag(ins_nf,-1)*stats::lag(insu,-1))
ins_f_adj = (ins_r_f - ins_p_f) - (stats::lag(ins_f,-1)*stats::lag(insu,-1))
ins_g_adj = (ins_r_g - ins_p_g) - (stats::lag(ins_g,-1)*stats::lag(insu,-1))
ins_h_adj = (ins_r_h - ins_p_h) - (stats::lag(ins_h,-1)*stats::lag(insu,-1))
ins_row_adj = (ins_r_row - ins_p_row) - (stats::lag(ins_row,-1)*stats::lag(insu,-1))
```

```{r}
ins_h_tr_excl_d8 = ins_h_tr - d8_h
```

Below I compute the adjustment variables that correct the discrepancy between net lending and financial net lending

```{r}
nl_h = s_h - i_h - np_h + ctr_h
fnl_h = iba_h_tr + sec_h_tr + l_h_tr + eq_h_tr + ins_h_tr
nl_h_adj = fnl_h -nl_h
```

```{r}
nl_nf = s_nf - i_nf - np_nf + ctr_nf
fnl_nf = iba_nf_tr + sec_nf_tr + l_nf_tr + Neq_nf_tr + ins_nf_tr
nl_nf_adj = fnl_nf - nl_nf
```

```{r}
nl_f = s_f - i_f - np_f + ctr_f
fnl_f = iba_f_tr + sec_f_a_tr + sec_f_d_tr + l_f_tr + eq_f_a_tr - eq_f_l_tr + ins_f_tr
nl_f_adj = fnl_f - nl_f
```

```{r}
nl_g = s_g - i_g - np_g + ctr_g
fnl_g = iba_g_tr + eq_g_tr + sec_g_tr + l_g_tr + ins_g_tr
nl_g_adj = fnl_g - nl_g 
```

```{r}
int_row = (stats::lag(idep,-1)*stats::lag(iba_row,-1) + stats::lag(iboa,-1)*stats::lag(sec_row,-1) + stats::lag(iloan,-1)*stats::lag(l_row,-1))

div_row = d_20124*(  (stats::lag(eq_row_a_nf,-1) + stats::lag(eq_row_a_f,-1))*stats::lag(divd,-1) - ((stats::lag(eq_nf_a_row,-1)+stats::lag(eq_f_a_row,-1)+stats::lag(eq_g_row,-1)+stats::lag(eq_h_row,-1))*stats::lag(diva,-1))) + (1-d_20124) * ((stats::lag(Neq_row,-1)*stats::lag(divd,-1))) + div_row_adj

insu_row = stats::lag(ins_row,-1)*stats::lag(insu,-1) 

npropinc_row = int_row + int_row_adj + div_row + insu_row + ins_row_adj + (res_r_row) - (res_p_row)

nl_row = m - x + p_tax_row - p_sub_row + (w_row_r - w_row_p) +  (npropinc_row) + (tax_row) + scon_row_r - scon_row_p + sben_row_r - sben_row_p + oth_row + ctr_row - np_row 

#nl_row1 = s_row + ctr_row - np_row

fnl_row = iba_row_tr + Neq_row_tr  + sec_row_tr + l_row_tr + ins_row_tr

nl_row_adj = fnl_row - nl_row 
```

```{r}
sumfnl = fnl_h + fnl_f + fnl_nf + fnl_g + fnl_row
sumnl = nl_h + nl_f + nl_nf + nl_g + nl_row
sumnladj = nl_h_adj + nl_f_adj + nl_nf_adj + nl_g_adj + nl_row_adj
```

tax rates for wages and property income (the two tax rates are determined throgh an exogenous regression without an intercept

```{r}
tax_h_hat =  tax_rate1*(w_h_r +nsben_h + oth_h) +  tax_rate2*(propinc_r_h - propinc_p_h + b2_h_r) 
tax_h_adj = (-tax_h -  tax_h_hat)
tax_h =  -(tax_h_hat + tax_h_adj)
yd2a_h =(1 - tax_rate2)*(propinc_r_h + b2_h_r) # property income part of the disposable income (capitalists)
yd2b_h = (1 - tax_rate2)*(-propinc_p_h) 
yd1_h =(1 - tax_rate1)*(w_h_r + nsben_h + oth_h) - tax_h_adj # wage and benefits part of the disposable income (workers)
tax_rate_nf = -tax_nf/y
```

Creating Real variables

```{r}
yd_hk=yd_h/pc # real disposable income
 w_h_rk = w_h_r/pc #real wages recieved by households
 nsben_hk  = nsben_h /pc #real social benefits recieved by the households
 npropinc_hk =  npropinc_h/pc # real property income (net) 
 b2_hk = b2_h_r/pc
 yd1_hk = yd1_h/pc  
 yd2a_hk = yd2a_h/pc
 yd2b_hk = yd2b_h/pc
```

```{r}
fnw_hk = fnw_h/pc #real net wealth of households
```

Variables for the estimation of the investment equation

```{r}
u=yk/(bd_nfc_k+equip_nfc_k) #Rate of capacity utilization
prate=s_nf/(stats::lag(bd_nfc,-1)+stats::lag(equip_nfc,-1)) # Profit rate
```

Labour market

```{r}
#empl = N/1000
#empl_ds = Nadj/1000
 wage = w_h_r/emp
# wage = w_h_rk_ds /(empl_ds)
 Nu=(w_row_r - w_row_p)/wage
 Nf = Nu + emp
 prod = y/Nf
 LF = unemp + emp
 lfadj = unempadj + empadj
 ur = unemp/LF
 ur_ds = unempadj/lfadj
# yk = y/(py/100)
 prodk = yk/Nf
 yf = w + b2
 ws = w/yf
 ps = 1 - ws
# w = w_h_r + (W_row_r - W_row_p)
 fdis = yf/y
 urterm = ur - urs
 wageindex = wage/wage[22] #element from 2010Q3
 priv = pconk + ik + xk
 part = LF*1000/pop
 old_age_ratio = retired_pop/pop
 zaland_jesper = pop - LF*1000  
 nben_h = nsben_h + d8_h
```

```{r}
nl_check= (nl_h + nl_f + nl_nf + nl_g + nl_row) # needs to be fixed:
 fnl_check= (fnl_h + fnl_f + fnl_nf + fnl_g + fnl_row)  # this one is fine: because there is almost no connection between the real side and financial side at the moment
 check_np = np_row + np_h + np_f + np_nf + np_g # this one is fine:
 check_ctr = ctr_row + ctr_h + ctr_f + ctr_nf + ctr_g # this one is fine:
 check_invest = i - i_f - i_nf - i_g - i_h # this one is fine:
 check_iba = iba_h + iba_f + iba_nf + iba_g + iba_row  #needs to be fixed:
 check_tax = tax_g + tax_nf + tax_f + tax_h + tax_row # this one is fine:
  check_iba_rv = iba_h_rv + iba_f_rv + iba_nf_rv + iba_g_rv + iba_row_rv 
  check_iba_tr = iba_h_tr + iba_f_tr + iba_nf_tr + iba_g_tr + iba_row_tr
 check_eq = eq_h + (eq_f_a - eq_f_l) + (eq_nf_a - eq_nf_l) + eq_g + (eq_row_a - eq_row_l) # This one is now fixed
 check_eq_tr = eq_h_tr + Neq_nf_tr  + Neq_f_tr + eq_g_tr + Neq_row_tr + eq_g_tr
  check_l = l_h + l_f + l_nf + l_g + l_row # problematic after scenario 2
 check_l_tr = l_f_tr + l_h_tr + l_nf_tr + l_g_tr + l_row_tr
  check_ins = ins_h + ins_f + ins_nf + ins_g + ins_row # problematic after scenario 2
 check_ins_tr =  ins_f_tr  + ins_h_tr + ins_nf_tr + ins_g_tr + ins_row_tr
check_sec = sec_h + sec_f_a + sec_f_d + sec_nf + sec_g + sec_row ## needs to be fixed
```

Ved ik helt om nedenstående skal med

```{r}
#smpl 2005q2 2019q1

#equation eq41.ls emp = P(251) + P(252)*SD1 + P(253)*SD2 + P(254)*SD3
#series  emp_ds = emp - (P(251) + P(252)*SD1 + P(253)*SD2 + P(254)*SD3) + @mean(emp)

tobinq = (eq_nf_l) / (equip_nfc + bd_nfc)
```


```{r}
library(mFilter)
library(bimets)
library(knitr)
```

# Deseasonalyse

```{r}

## I_BD_H_K
reg_1 = lm(i_bd_h_k~ sd1+ sd2 + sd3)

i_bd_h_k_ds= reg_1$residuals + mean(i_bd_h_k)

i_bd_h_k_ds=ts(i_bd_h_k_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_10 =reg_1$coefficients[1]
alpha_10=ts(alpha_10,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_11=reg_1$coefficients[2]
alpha_11=ts(alpha_11,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_12=reg_1$coefficients[3]
alpha_12=ts(alpha_12,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_13=reg_1$coefficients[4]
alpha_13=ts(alpha_13,start = c(2005,2), end = c(2020,1), frequency = 4 )

mean_i_bd_h_k= mean(i_bd_h_k)
mean_i_bd_h_k=ts(mean_i_bd_h_k,start = c(2005,2), end = c(2020,1), frequency = 4 )


## I_EQUIP_H_K


reg_3 = lm(i_equip_h_k~ sd1+ sd2 + sd3)

i_equip_h_k_ds= reg_3$residuals + mean(i_equip_h_k)

i_equip_h_k_ds=ts(i_equip_h_k_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_20 =reg_3$coefficients[1]
alpha_20=ts(alpha_20,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_21=reg_3$coefficients[2]
alpha_21=ts(alpha_21,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_22=reg_3$coefficients[3]
alpha_22=ts(alpha_22,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_23=reg_3$coefficients[4]
alpha_23=ts(alpha_23,start = c(2005,2), end = c(2020,1), frequency = 4 )

mean_i_equip_h_k= mean(i_equip_h_k)
mean_i_equip_h_k=ts(mean_i_equip_h_k,start = c(2005,2), end = c(2020,1), frequency = 4 )


# i_bd_nfc_k_ds

reg_4 = lm(i_bd_nfc_k~ sd1+ sd2 + sd3)

i_bd_nfc_k_ds= reg_4$residuals + mean(i_bd_nfc_k)

i_bd_nfc_k_ds=ts(i_bd_nfc_k_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )


alpha_30 =reg_4$coefficients[1]
alpha_30=ts(alpha_30,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_31=reg_4$coefficients[2]
alpha_31=ts(alpha_31,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_32=reg_4$coefficients[3]
alpha_32=ts(alpha_32,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_33=reg_4$coefficients[4]
alpha_33=ts(alpha_33,start = c(2005,2), end = c(2020,1), frequency = 4 )

mean_i_bd_nfc_k= mean(i_bd_nfc_k)
mean_i_bd_nfc_k=ts(mean_i_bd_nfc_k,start = c(2005,2), end = c(2020,1), frequency = 4 )

## u_ds
reg_5 = lm(u~ sd1+ sd2 + sd3)

u_ds= reg_5$residuals + mean(u)

u_ds=ts(u_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

## ps_ds
reg_6 = lm(ps~ sd1+ sd2 + sd3)

ps_ds= reg_6$residuals + mean(ps)

ps_ds=ts(ps_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )


## i_equip_nfc_k_ds
reg_7 = lm(i_equip_nfc_k~ sd1+ sd2 + sd3)

i_equip_nfc_k_ds= reg_7$residuals + mean(i_equip_nfc_k)

i_equip_nfc_k_ds=ts(i_equip_nfc_k_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_40 =reg_7$coefficients[1]
alpha_40=ts(alpha_40,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_41=reg_7$coefficients[2]
alpha_41=ts(alpha_41,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_42=reg_7$coefficients[3]
alpha_42=ts(alpha_42,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_43=reg_7$coefficients[4]
alpha_43=ts(alpha_43,start = c(2005,2), end = c(2020,1), frequency = 4 )

mean_i_equip_nfc_k= mean(i_equip_nfc_k)
mean_i_equip_nfc_k=ts(mean_i_equip_nfc_k,start = c(2005,2), end = c(2020,1), frequency = 4 )


## pconk_ds 

reg_8 = lm(pconk~ sd1+ sd2 + sd3)

pconk_ds= reg_8$residuals + mean(pconk)

pconk_ds=ts(pconk_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_00 =reg_8$coefficients[1]
alpha_00=ts(alpha_00,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_01=reg_8$coefficients[2]
alpha_01=ts(alpha_01,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_02=reg_8$coefficients[3]
alpha_02=ts(alpha_02,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_03=reg_8$coefficients[4]
alpha_03=ts(alpha_03,start = c(2005,2), end = c(2020,1), frequency = 4 )

mean_pconk= mean(pconk)
mean_pconk=ts(mean_pconk,start = c(2005,2), end = c(2020,1), frequency = 4 )

## B2_HK_ds 

reg_9 = lm(b2_hk~ sd1+ sd2 + sd3)

b2_hk_ds= reg_9$residuals + mean(b2_hk)

b2_hk_ds=ts(b2_hk_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

## yd1_hk 

reg_10 = lm(yd1_hk~ sd1+ sd2 + sd3)

yd1_hk_ds= reg_10$residuals + mean(yd1_hk)

yd1_hk_ds=ts(yd1_hk_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_100 =reg_10$coefficients[1]
alpha_100=ts(alpha_100,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_101=reg_10$coefficients[2]
alpha_101=ts(alpha_101,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_102=reg_10$coefficients[3]
alpha_102=ts(alpha_102,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_103=reg_10$coefficients[4]
alpha_103=ts(alpha_103,start = c(2005,2), end = c(2020,1), frequency = 4 )

mean_yd1_hk= mean(yd1_hk)
mean_yd1_hk=ts(mean_yd1_hk,start = c(2005,2), end = c(2020,1), frequency = 4)



## yd2a_hk 

reg_11 = lm(yd2a_hk~ sd1+ sd2 + sd3)

yd2a_hk_ds= reg_11$residuals + mean(yd2a_hk)

yd2a_hk_ds=ts(yd2a_hk_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_110 =reg_11$coefficients[1]
alpha_110=ts(alpha_110,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_111=reg_11$coefficients[2]
alpha_111=ts(alpha_111,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_112=reg_11$coefficients[3]
alpha_112=ts(alpha_112,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_113=reg_11$coefficients[4]
alpha_113=ts(alpha_113,start = c(2005,2), end = c(2020,1), frequency = 4 )

mean_yd2a_hk= mean(yd2a_hk)
mean_yd2a_hk=ts(mean_yd2a_hk,start = c(2005,2), end = c(2020,1), frequency = 4)

##w_h_rk

reg_12 = lm(w_h_rk~ sd1+ sd2 + sd3)

w_h_rk_ds= reg_12$residuals + mean(w_h_rk)

w_h_rk_ds=ts(w_h_rk_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

## wage 

reg_13 = lm(wage~ sd1+ sd2 + sd3)

wage_ds= reg_13$residuals + mean(wage)

wage_ds=ts(wage_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_50 =reg_13$coefficients[1]
alpha_50=ts(alpha_50,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_51=reg_13$coefficients[2]
alpha_51=ts(alpha_51,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_52=reg_13$coefficients[3]
alpha_52=ts(alpha_52,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_53=reg_13$coefficients[4]
alpha_53=ts(alpha_53,start = c(2005,2), end = c(2020,1), frequency = 4 )

mean_wage= mean(wage)
mean_wage=ts(mean_wage,start = c(2005,2), end = c(2020,1), frequency = 4)

## pc 

reg_14 = lm(pc~ sd1+ sd2 + sd3)

pc_ds= reg_14$residuals + mean(pc)

pc_ds=ts(pc_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_60 =reg_14$coefficients[1]
alpha_60=ts(alpha_60,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_61=reg_14$coefficients[2]
alpha_61=ts(alpha_61,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_62=reg_14$coefficients[3]
alpha_62=ts(alpha_62,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_63=reg_14$coefficients[4]
alpha_63=ts(alpha_63,start = c(2005,2), end = c(2020,1), frequency = 4 )

mean_pc= mean(pc)
mean_pc=ts(mean_pc,start = c(2005,2), end = c(2020,1), frequency = 4)

## pm 

reg_15 = lm(pm~ sd1+ sd2 + sd3)

pm_ds= reg_15$residuals + mean(pm)

pm_ds=ts(pm_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

### ur 


reg_16 = lm(ur~ sd1+ sd2 + sd3)

ur_ds= reg_16$residuals + mean(ur)

ur_ds=ts(ur_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_140 =reg_16$coefficients[1]
alpha_140=ts(alpha_140,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_141=reg_16$coefficients[2]
alpha_141=ts(alpha_141,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_142=reg_16$coefficients[3]
alpha_142=ts(alpha_142,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_143=reg_16$coefficients[4]
alpha_143=ts(alpha_143,start = c(2005,2), end = c(2020,1), frequency = 4 )

mean_ur= mean(ur)
mean_ur=ts(mean_ur,start = c(2005,2), end = c(2020,1), frequency = 4)



## yk 

reg_17 = lm(yk~ sd1+ sd2 + sd3)

yk_ds= reg_17$residuals + mean(yk)

yk_ds=ts(yk_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )


alpha_90 =reg_17$coefficients[1]
alpha_90=ts(alpha_90,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_91=reg_17$coefficients[2]
alpha_91=ts(alpha_91,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_92=reg_17$coefficients[3]
alpha_92=ts(alpha_92,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_93=reg_17$coefficients[4]
alpha_93=ts(alpha_93,start = c(2005,2), end = c(2020,1), frequency = 4 )

mean_yk= mean(yk)
mean_yk=ts(mean_yk,start = c(2005,2), end = c(2020,1), frequency = 4)

## wageindex 

reg_18 = lm(wageindex~ sd1+ sd2 + sd3)

wageindex_ds= reg_18$residuals + mean(wageindex)

wageindex_ds=ts(wageindex_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

## priv 

reg_19 = lm(priv~ sd1+ sd2 + sd3)

priv_ds= reg_19$residuals + mean(priv)

priv_ds=ts(priv_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

## mk 

reg_20 = lm(mk~ sd1+ sd2 + sd3)

mk_ds= reg_20$residuals + mean(mk)

mk_ds=ts(mk_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_70 =reg_20$coefficients[1]
alpha_70=ts(alpha_70,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_71=reg_20$coefficients[2]
alpha_71=ts(alpha_71,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_72=reg_20$coefficients[3]
alpha_72=ts(alpha_72,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_73=reg_20$coefficients[4]
alpha_73=ts(alpha_73,start = c(2005,2), end = c(2020,1), frequency = 4 )

mean_mk= mean(mk)
mean_mk=ts(mean_mk,start = c(2005,2), end = c(2020,1), frequency = 4)

## prodk 

reg_21 = lm(prodk~ sd1+ sd2 + sd3)

prodk_ds= reg_21$residuals + mean(prodk)

prodk_ds=ts(prodk_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )


## prate 

##This one is shorter but not sure it also is in the Eviews code

reg_22 = lm(prate~ sd1[-1]+ sd2[-1] + sd3[-1])

prate_ds= reg_22$residuals + mean(prate)

prate_ds=ts(prate_ds,start = c(2005,3), end = c(2020,1), frequency = 4 )

alpha_120 =reg_22$coefficients[1]
alpha_120=ts(alpha_120,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_121=reg_22$coefficients[2]
alpha_121=ts(alpha_121,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_122=reg_22$coefficients[3]
alpha_122=ts(alpha_122,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_123=reg_22$coefficients[4]
alpha_123=ts(alpha_123,start = c(2005,2), end = c(2020,1), frequency = 4 )

mean_prate= mean(prate)
mean_prate=ts(mean_prate,start = c(2005,2), end = c(2020,1), frequency = 4)


## bd_nfc_k 

reg_23 = lm(bd_nfc_k~ sd1+ sd2 + sd3)

bd_nfc_k_ds= reg_23$residuals + mean(bd_nfc_k)

bd_nfc_k_ds=ts(bd_nfc_k_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )



## xk 

reg_24 = lm(xk~ sd1+ sd2 + sd3)

xk_ds= reg_24$residuals + mean(xk)

xk_ds=ts(xk_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )


alpha_80 =reg_24$coefficients[1]
alpha_80=ts(alpha_80,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_81=reg_24$coefficients[2]
alpha_81=ts(alpha_81,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_82=reg_24$coefficients[3]
alpha_82=ts(alpha_82,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_83=reg_24$coefficients[4]
alpha_83=ts(alpha_83,start = c(2005,2), end = c(2020,1), frequency = 4 )

mean_xk= mean(xk)
mean_xk=ts(mean_xk,start = c(2005,2), end = c(2020,1), frequency = 4)
## rer 

reg_25 = lm(rer~ sd1+ sd2 + sd3)

rer_ds= reg_25$residuals + mean(rer)

rer_ds=ts(rer_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

## prod 

reg_27 = lm(prod~ sd1+ sd2 + sd3)

prod_ds= reg_27$residuals + mean(prod)

prod_ds=ts(prod_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

## ps 

reg_28 = lm(ps~ sd1+ sd2 + sd3)

ps_ds= reg_28$residuals + mean(ps)

ps_ds=ts(ps_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_130 =reg_28$coefficients[1]
alpha_130=ts(alpha_130,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_131=reg_28$coefficients[2]
alpha_131=ts(alpha_131,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_132=reg_28$coefficients[3]
alpha_132=ts(alpha_132,start = c(2005,2), end = c(2020,1), frequency = 4 )

alpha_133=reg_28$coefficients[4]
alpha_133=ts(alpha_133,start = c(2005,2), end = c(2020,1), frequency = 4 )

mean_ps= mean(ps)
mean_ps=ts(mean_ps,start = c(2005,2), end = c(2020,1), frequency = 4)

## y 

reg_29 = lm(y~ sd1+ sd2 + sd3)

y_ds= reg_29$residuals + mean(y)

y_ds=ts(y_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )
```

```{r}
## Disse skal komme efter deseason

rw_ds = wage_ds/pc_ds #real wage rate based on deseasonalized variables
reprate_bd_h = (mean(delta_bd_h)*stats::lag(bd_h_k,-1))/i_bd_h_k_ds # replacement rate

#New wage equations
inflation= (pc/TSLAG(pc,4)) - 1

inflation_t= (pc/TSLAG(pc,4)) - 1
inflation_t = ts(c(0,0,0, inflation_t), start = c(2005,3), frequency = 4 )


wage_ds_t= sd1* wage_ds*(1+inflation_t) + sd2* TSLAG(wage_ds,1)*(1+TSLAG(inflation_t,1)) + sd3* TSLAG(wage_ds,2)*(1+TSLAG(inflation_t,2)) + sd4* TSLAG(wage_ds,3)*(1+TSLAG(inflation_t,3))

inflation_tt= inflation_t


# New price equations

pg_adj = log(pg) - (0.840852289293*log(pc) - 0.0401650251402)

p_bd_adj = log(p_bd) - (0.988897636487*log(pc) +
0.0286611434831)

p_equip_adj = log(p_equip) -( 0.304376220161*log(pc) +
0.0160136953595 )

px_adj= log(px) - (0.638216896739*log(pc) - 0.012650117362)
```


# Extra variables created to run the model:

```{r}
eq_nf_lx =   eq_nf_a_nf + eq_h_nf + eq_row_a_nf + eq_f_a_nf + eq_g_nf
yh2a = propinc_r_h + b2_h_r
yh2b = - propinc_p_h
aa_check = TSLAG(eq_h_f,1)*TSLAG(divd,1)
insu_h = TSLAG(ins_h,1)*TSLAG(insu,1) + ins_h_adj
yd_h1 = yh_h + tax_h + nben_h
sec_h_tr_g=sec_h_tr
eq_h_test = eq_h - (eq_h_nf + eq_h_f + eq_h_row)
lev_h = l_h/yd_h
fa_h = iba_h + sec_h + eq_h + ins_h
sk= pconk + ik + gk + xk
s = pcon + g + i + x
w_nf = w_h_r +  (w_row_r - w_row_p)
int_nf = (TSLAG(idep,1)*TSLAG(iba_nf,1) + TSLAG(ibd,1)*TSLAG(sec_nf,1) + TSLAG(iloan,1)*TSLAG(l_nf,1)) 
insu_nf =  TSLAG(ins_nf,1)*TSLAG(insu,1)
npropinc_nf = int_nf + int_nf_adj + div_nf + insu_nf + ins_nf_adj + (res_r_nf ) - (res_p_nf)
eq_nf_ax =  eq_nf_a_nf + eq_nf_a_f + eq_nf_a_row
eq_nf_a_test = eq_nf_a - eq_nf_ax
eq_f_lx =   eq_nf_a_f + eq_h_f + eq_row_a_f + eq_f_a_f + eq_g_f
eq_nf_l_test = eq_nf_l - eq_nf_lx 
fnw_nfk = fnw_nf/pc
int_f =(TSLAG(idep,1)*TSLAG(iba_f,1) + TSLAG(iloan,1)*TSLAG(l_f,1) + TSLAG(ibd,1)*TSLAG(sec_f_d,1) + TSLAG(iboa,1)*TSLAG(sec_f_a,1)) 
insu_f = TSLAG(ins_f,1)*TSLAG(insu,1)
npropinc_f = int_f + int_f_adj +  div_f + insu_f + ins_f_adj + (res_r_f) - (res_p_f)
nben_f = d8_f 
eq_f_ax =  eq_f_a_nf + eq_f_a_f + eq_f_a_row
eq_f_l_test = eq_f_l - (eq_f_l_f + eq_h_f + eq_row_a_f + eq_nf_a_f + eq_g_f)
sec_f_d_tr_nf=-sec_nf_tr
sec_f_d_tr_g=sec_f_d_tr-sec_f_d_tr_nf
fnw_fk = fnw_f/pc
int_g = (TSLAG(idep,1)*TSLAG(iba_g,1) + TSLAG(iloan,1)*TSLAG(l_g,1) + TSLAG(ibd,1)*TSLAG(sec_g,1))
insu_g = TSLAG(ins_g,1)*TSLAG(insu,1)
npropinc_g = int_g + int_g_adj + div_g + insu_g + ins_g_adj + (res_r_g) - ( res_p_g)
nben_row = scon_row_r - scon_row_p + sben_row_r - sben_row_p
nben_g = - (nben_row + nsben_h + nben_f)
eq_g_ax =  eq_g_row + eq_g_f + eq_g_nf
eq_g_test = eq_g - (eq_g_nf + eq_g_f + eq_g_row)
fnw_gk = fnw_g/pc
nx = x - m
cab =-nl_row
fab = (fnl_row)
bop = cab + fab
eq_row_ax =  eq_row_a_nf + eq_row_a_f
eq_row_a_test = eq_row_a - (eq_row_a_nf + eq_row_a_f)
eq_row_lx = eq_nf_a_row + eq_h_row + eq_f_a_row + eq_g_row
eq_row_l_test = eq_row_l - (eq_nf_a_row + eq_f_a_row + eq_g_row + eq_h_row)
fnw_rowk = fnw_row/pc
mkp = pc_ds / (wage_ds/prodk_ds + pm_ds)
acc_rate = ik / (bd_h_k+equip_h_k+bd_nfc_k+equip_nfc_k+bd_fc_k+equip_fc_k+bd_g_k+equip_g_k)
yh1 = w_h_r +  nsben_h + oth_h
yd_hk_ds = yd1_hk_ds +yd2a_hk_ds + yd2b_hk
propinc_p_nf = int_p_nf + div_p_nf + ins_p_nf + res_p_nf
propinc_r_nf = int_r_nf + div_r_nf + ins_r_nf + res_r_nf
```


# Shock variables

```{r}
## Creating the new shock variables
g_shock= g*1.02
prodk_ds_shock = prodk_ds
max_dp_shock= obs_dp_q

## Shock_1
pf_shock= pf+pf*0.1
pm_ds_shock= pm_ds+pm_ds*0.1

## Shock 2
iloan_shock= iloan + 0.03
idep_shock= idep + 0.03
ibd_shock= ibd + 0.03
iboa_shock= iboa + 0.03

## Shock 3 

tax_rate1_shock= ts(c(0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369,0.369369), start = c(2005, 2), end =  c(2020,1), frequency = 4)

#### Shock variables 
shock_g_model=ts(0,start = c(2005,2), end = c(2020,1), frequency = 4)
shock_1_model=ts(0,start = c(2005,2), end = c(2020,1), frequency = 4)
shock_2_model=ts(0,start = c(2005,2), end = c(2020,1), frequency = 4)
shock_3_model=ts(0,start = c(2005,2), end = c(2020,1), frequency = 4)
```

# New variables for LF model

## Wage_trim

As some of the variables are yearly and stock variables we devide them by 4 

```{r}
tyd_q= tyd/4
tydd_q= tydd/4
```


```{r, fig.width=10, fig.height=7}

w_h_r_trim1 = w_h_r
wage_trim1 = w_h_r_trim1/emp
## Deseasonalize

reg_30 = lm(wage_trim1~ sd1+ sd2 + sd3)

wage_trim1_ds= reg_30$residuals + mean(wage_trim1)

wage_trim1_ds=ts(wage_trim1_ds,start = c(2005,2), end = c(2020,1), frequency = 4 )

plot(wage_trim1_ds)

```

Vi kan se at den store forskel ligger i om vi bruger unemployment data fra vores model eller ADAM. 

## Komp_r bruges

```{r}

library(magrittr)

#Yearly change in wage: (as max dagpenge kun ændres årligt?)

wage_growth=TSDELTA(wageindex,4)

wage_growth_1q=as.data.frame(as.numeric(wage_growth)[c(1,4,8,12,16,20,24,28,32,36,40,44,48,52,56)]) # Jeg bruger kvartal 2 fra 2006 som udviklling i 2006

wage_growth_1q %<>% 
  rename(Q1='as.numeric(wage_growth)[c(1, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56)]')
```


De nævner selv at den løn stigning der regnes med er fratrukket arbejdsgiveradministrerede pensionsordninger 


```{r}
#Udregninger af maximal dagpenge beløb er lavet i "udregning af dagpenge"

komp_r_ny = obs_dp_q/ wage_trim1
plot(komp_r_ny)


komp_r_ny1 = wage_dp_q/ wage_trim1
plot(komp_r_ny1)
```


## Udregning af dagpenge total

```{r}
adam_dp_person= (tyd/uld)/4
```


```{r}
## Måske brug IV-regression men passer nok ikke data godt så. 
total_dp_reg=lm(adam_dp_person ~ 0 +max_dp_quarter) 

mean_dp_regul= 0.9507*obs_dp_q
nben_h_un_obs=mean_dp_regul*unemp*kuld
komp_r_obs=mean_dp_regul/wage_trim1
nben_h_rest_obs= nben_h - nben_h_un_obs



## Changes to wage equation
growth_mean_dp_regul= (mean_dp_regul/TSLAG(mean_dp_regul,4)) - 1

growth_mean_dp_regul_t= ts(c(0,0,0, growth_mean_dp_regul), start = c(2005,3), frequency = 4 )

wage_ds_t_growth= 0.5*inflation_t+0.5*growth_mean_dp_regul_t

wage_ds_t_new= sd1* wage_ds*(1+wage_ds_t_growth) + sd2* TSLAG(wage_ds,1)*(1+TSLAG(wage_ds_t_growth,1)) + sd3* TSLAG(wage_ds,2)*(1+TSLAG(wage_ds_t_growth,2)) + sd4* TSLAG(wage_ds,3)*(1+TSLAG(wage_ds_t_growth,3))
wage_gap= wage_ds_t - mean_dp_regul


## Change to wage equation


wage_ds_t_new1= ifelse(sd1*wage_ds*(1+inflation_t) + sd2* TSLAG(wage_ds,1)*(1+TSLAG(inflation_t,1)) + sd3* TSLAG(wage_ds,2)*(1+TSLAG(inflation_t,2)) + sd4* TSLAG(wage_ds,3)*(1+TSLAG(inflation_t,3)) , )
                       
                       


```


```{r}
mean_dp_wage= 0.9507*wage_dp_q
total_dp_wage= mean_dp_wage*unemp*kuld
komp_r_wage=mean_dp_wage/wage_trim1


```



#Empirical testing

```{r}
library(dynlm)
library(urca)
library(forecast)
library(car)
```

## ADF testing

### Part

Slettet alt indledende for mere plads

```{r}
urca_part= ur.df(part, lags = 2, type = "drift")
summary(urca_part)
```

Ser ud til vi skal tage diff

```{r}
urca_part_diff= ur.df(diff(part), lags = 1, type = "drift")

summary(urca_part_diff)
```

part is I(1)

### Komp_r

```{r}
model_start_komp <- dynlm(diff(komp_r_obs) ~ 1+ L(komp_r_obs, 1) + L(diff(komp_r_obs), c(1,2,3,4)))
summary(model_start_komp)
```

```{r}
res_start_komp= residuals(model_start_komp)
shapiro.test(res_start_komp)
```

```{r}
urca_komp_r= ur.df(komp_r_obs, lags = 4, type = "drift")
summary(urca_komp_r)
```

Ser ud til vi skal tage diff

```{r}
urca_komp_r_diff= ur.df(diff(komp_r_obs), lags = 3, type = "drift")

summary(urca_komp_r_diff)
```

Ser ud til komp_r er I(0) på 10% significans niveau, meget tæt på 5%

## Econometrics models:

## Error correction model

### part

```{r}
reg_part_start=dynlm(TSDELTALOG(part) ~ 1 + L(TSDELTALOG(part),1:4) +  L(TSDELTALOG(komp_r_obs),0:4)+  L(TSDELTALOG(rw_ds),0:4) + L(TSDELTA(ur_ds),0:4)+ L(log(part),1) + L(log(komp_r_obs),1) + L(log(rw_ds),1) + L((ur_ds),1) + d_2013q4)

summary(reg_part_start)
```

```{r}
res_reg_part=residuals(reg_part_start)
shapiro.test(res_reg_part)
```

Use F-es to remove lags

```{r}
 komp_r_vars_1 <- str_c("L(TSDELTALOG(komp_r_obs), 0:4)", c(1,2,4))
 part_vars_1 <- str_c("L(TSDELTALOG(part), 1:4)", c(1,3,4))
 rw_ds_vars_1 <- str_c("L(TSDELTALOG(rw_ds), 0:4)", c(0,2,3,4))
 ur_ds_vars_1 <- str_c("L(TSDELTA(ur_ds), 0:4)", c(0,1,2,3,4))
```

```{r}


vars_out_1 <- c(komp_r_vars_1,part_vars_1, rw_ds_vars_1,ur_ds_vars_1)
vars_out_1
 
linearHypothesis(reg_part_start, vars_out_1, rep(0, length(vars_out_1)))

```

Final model

```{r}
reg_part=dynlm(TSDELTALOG(part) ~ 1 + L(TSDELTALOG(part),2) +  L(TSDELTALOG(komp_r_obs),c(0,3))+  L(TSDELTALOG(rw_ds),1) + L(log(part),1) + L(log(rw_ds),1) + L((ur_ds),1) + d_2013q4)

summary(reg_part)
```


```{r}
"TSDELTALOG(part) = beta_0 + beta_1*TSDELTALOG(TSLAG(part,2)) + beta_2*TSDELTALOG(TSLAG(rw_ds,1)) + beta_3*TSDELTALOG(komp_r) + beta_4*TSDELTALOG(TSLAG(komp_r,3))  + beta_6*LOG(TSLAG(part,1))  + beta_7*log(TSLAG(rw_ds,1)) + beta_8*TSLAG(ur_ds,1) + beta_9* d_2013q4"
```


### wage_ds

```{r}
"COMMENT> 
BEHAVIORAL> wage_ds
TSRANGE 2006 3 2020 1
EQ> TSDELTALOG(wage_ds) = p_520 + p_522* TSDELTA(TSLAG(ur,4)) + p_523* TSDELTALOG(prod_ds) + p_524* LOG(TSLAG(wage_ds,1)) + p_525* LOG(TSLAG(wage_ds_t,1)) + p_526* LOG(TSLAG(prod_ds,1)) + p_527* (d_2009q1 + d_2009q2)
COEFF> p_520 p_522 p_523 p_524 p_525 p_526 p_527 
STORE> coe(20)"
```


**Test med forskellige løn scenarier**

```{r}

mean_dp_growth= TSDELTA(mean_dp_regul,4)/TSLAG(mean_dp_regul,4)

obs_dp_growth= TSDELTA(obs_dp_q,4)/TSLAG(obs_dp_q,4)

wage_ds_growth= TSDELTA(wage_ds,4)/TSLAG(wage_ds,4)

dummy_test= ifelse(mean_dp_growth > wage_ds_growth, 1,0)

dummy_test1= ifelse(obs_dp_growth > wage_ds_growth, 1,0)

wage_gap= TSLAG(wage_ds,1)- mean_dp_regul

wage_ratio= TSLAG(wage_ds,1)/ mean_dp_regul

```


```{r}
options(scipen = 999)

test_dummy= d_2009q1 + d_2009q2 
reg_wage_ds_start=dynlm(TSDELTALOG(wage_ds) ~ 1+ L(TSDELTA(wage_ds), 1:4) + L(TSDELTA(ur), 0:4)+ L(TSDELTALOG(prod_ds), 0:4) + L(wage_ratio, 0)+  L(log(wage_ds_t), 1)  + log(TSLAG(wage_ds,1))  + log(TSLAG(prod_ds,1)) + test_dummy)

summary(reg_wage_ds_start)


```

```{r}
res_reg_wage_ds=residuals(reg_wage_ds_start)
shapiro.test(res_reg_wage_ds)
```

Use F-test to remove lags

```{r}

 wage_ds_vars_1 <- str_c("L(TSDELTA(wage_ds), 1:4)", c(1,3,4))
 ur_ds_vars_1 <- str_c("L(TSDELTA(ur), 0:4)", c(0,2,3,4))
 prodk_ds_vars_1 <- str_c("L(TSDELTALOG(prod_ds), 0:4)", c(1,2,3,4))
 mean_dp_regul_vars_1 <- str_c("L(TSDELTALOG(mean_dp_regul), 0:4)", c(0,1,3,4))
 
```

```{r}
library(car)

vars_out_1 <- c( mean_dp_regul_vars_1, wage_ds_vars_1,ur_ds_vars_1,prodk_ds_vars_1 )
vars_out_1
 
linearHypothesis(reg_wage_ds_start, vars_out_1, rep(0, length(vars_out_1)))

```

Final model

```{r}
reg_wage_ds=dynlm(TSDELTALOG(wage_ds) ~ 0 + L(TSDELTA(ur), 1)+ L(TSDELTALOG(prod_ds), 0)+ L(TSDELTALOG(mean_dp_regul), 2)+  L(log(wage_ds_t), 1)  + log(TSLAG(wage_ds,1))  + log(TSLAG(prod_ds,1)) + (log(TSLAG(mean_dp_regul,1)):dummy_test) + test_dummy )

### Når jeg bare inkludere den som lr i modellen er den signifikant!


summary(reg_wage_ds)

```

```{r}
"EQ> TSDELTALOG(rw_ds) = p_521*TSDELTALOG(TSLAG(rw_ds,1)) + p_522*TSDELTALOG(TSLAG(rw_ds,2))+ p_523*TSDELTALOG(TSLAG(rw_ds,3)) + p_524*TSDELTALOG(komp_r) + p_525*TSDELTALOG(TSLAG(komp_r,1)) + p_526*TSDELTALOG(TSLAG(komp_r,2)) + p_527*TSDELTALOG(TSLAG(komp_r,3))+  p_528*TSDELTALOG(prodk_ds) + p_529*LOG(TSLAG(rw_ds,1)) + p_530*TSLAG(ur_ds,2) + p_531*LOG(TSLAG(prodk_ds,2)) + p_532*d_2011q1
COEFF> phi p_521 p_522 p_523 p_524 p_525 p_526 p_527 p_528 p_529 p_530 p_531 p_532
STORE> coe(13)"
```

